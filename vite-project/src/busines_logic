// РЕМОНТ

/*
    вопрос по бизнеслогике и как организовать програмно:
процесс фиксации ремонта подходящий для всех возможных сценариев.

сценарии типа  "текущий ремонт" 
шаг 1 велосипед неожиданно сломался

шаг2
 
вариант1 запчасти в наличии или не требуются, сотрудник свободен, велосипед сразу починили
ставим тип ремонта  текущий, пропускаем статусы запланирован и в ремонте, сразу ставим ремонт выполнен, запчасти - нет. После  применения статуса ремонт выполнен в общей таблице велосипедов ставим статус в наличии при любом сценарии.

вариант2 запчасти в наличии или не требуются, у сотрудника нет времени сделать ремонт прямо сейчас, велосипед физически ставится в сторонку пока руки не дойдут. тип ремонта текущий. статус в ремонте, необходимость запчастей - нет, в общей таблице ставим в ремонте (недоступен для проката) шаг 2 после ремонта ставим статус ремонт выполнен, в общей таблице ставим в наличии. 

вариант3 Нет необходимых запчастей. у сотрудника нет времени сделать ремонт прямо сейчас или есть не важно. велосипед физически ставится в сторонку пока не приедут запчасти. тип ремонта текущий. статус в ремонте. необходимость запчастей - да. шаг 2 после ремонта ставим статус ремонт выполнен, в общей таблице ставим в наличии. 

возможно есть еще какие то сценарии редкие и не очень которые я не учел/не описал, например в процессе ремонта нужно добавить в таблицу событие долгосрочный ремонт со статусом запланированн на конец сезона и отметить запчасти которые будут нужны.
один и тот же велосипед не должен иметь одновременно два статуса в ремонте


сценарии типа  "еженедельный ремонт" 
шаг 1  все велосипеды добавляются в спиок ремонтов раз в неделю по воскресеньям ночью автоматически с типом еженедельный, статусом запланированн. при статусе запланированн имеет смысл указываать дату на когда заплангированн и выводить в отдельном столбике. нужно придумать механизм массового планирования ремонтов для сотни велосипедов с возможностью указать конкретные дни недели(с датой) для каждого. этот график должен обновляться в автоматическом режиме каждый раз без моего участия. но у меня должна оставаться возможность вносить коррективы какой велосипед теперь обслуживается в какой день с понедельника по пятницу, даты программма расставляет автоматически по календарю учитывая день недели. 
 если какие-то велосипеды остались без ремонта на прошлой неделе - не получили статус ремонт выполнен, новое событие ремонта для них создаваться не должно. велосипеды у которых статус ремонта запланирован и стоит дата например 20.07.2025 долж подсвечиваться например в столбике даты красным начиная со следующего дня. зеленым если запланирован на 20 а сегодня 20е, никак не подсвечиваться если сегодня меньше 20. и если ремонт выполнен не знаю нужно ли хранить эту дату и цвет.

 сотрудники открыв программу видят  все велосипеды с событием еженедельный ремонт, могут остортировать по дате или по цвету условно чтобы нагнать график. идут по списку в произвольном порядке и по мере выпонения меняют статус на в ремонте, если не могут сделать сразу или ремонт выполнен. если за понедельник не успели сделать ремонт всех велосипедов с типом еженедльный и текущей датой, они никуда не исчезают из таблицы, они могут сделать их и на следующий день и через неделю.
в прошлом сценарии время начала ремонта можно было легко посчитать с момента установки стауса в ремонте, как считать тут неопнятно, возможно при первом сценарии если сразу поставили статус ремонт выполен время затраченрое считать 15 минут по умолчанию с возможностью изменить, а при наличии перед ремонт выполнен статуса в ремонте считать по формуле какой-то. как тут считать не понятно,  возможно если после статуса запланирован идет статус ремонт выполнен по умолчанию так же ставить 15 минут, а если в ремонте а потом ремонт выполнен считать разницу времени.

сценарии типа  "долгосрочный ремонт" 
в процессе/по результатам текущего/еженедельного ремонта или по другим причинам механик может захотеть запланировать событие типа долгосрочный ремонт. Это ремонт который не требует срочности и планируется на когда-то потом через месяц, два пол года и т.д. Например механик считает что через 2 месяца на конкретном велосипеде будет пора поменять цепь и покрышку. велосипед фактически может спокойно ездить до начала такого ремонта если у него не сломалось что-то еще. основная задача такого ремонта долгосроное планирование и понимание обьема запчастей которые нужно заранее закупить. нам следует реализовать механизм который проверяет наличие запчастей на складе при добавлении в ремонт. если запчастей не хватает, они попадают в список на закупку на страницу /parts-requests на этой странице мы можем менять статусы закупки и обновлять склад. при зменении склада если товара достаточно конкретный ремонт который ждет запчасти должен получать отметку что сейчас товара хватает.

//что делать со столбиком необходимость запчастей, надо ли менять статус после приезда запчастей на склад? нужен ли вообще этот столюик в бд или можно как то по другому выводить список поломанных велосипедов с фильтрацией нужны запчасти или можно начинать делать ремонт.  когда списываем запчасти со склада на ремонт, фиксируем стоимость ремонта - закупочную стоимость потраченных запчастей. Это нужно делать в момент смены статуса на ремонт завершен или когда добавили запчасть в ремонт и при каждом добавлении пересчитывать стоимость конкретного ремонт.  как вычислять общее время которое велосипед провел в ремонте, по таблице велосипепедов общей где мы фиксируем изменения статуса в прокате, забронирован, в ремонте, украден и т.д. как сумму разниц по времени между статусами событий в наличии и в ремонте.  или по таблице с ремонтами по отрезкам между статусом в ремонте и ремонт завершен. надо ли эти значения времени хранить где-то отдельно или каждый раз считать динамически при запросе аналитики простоев за период.  возмо проще считать продолжительность каждого статуса по формуле разницы столбиков столбик заверешено - created at = время длительности конкретного статуса, столбик завершено заполнять когда появляеться новый статус для конкретного велосипеда?. если так то как определить после появления какого статуса заполнять столюик завершено, ведь находясь в ремонте у велосипеда может быть найдена какая-то большая но не срочная неисправность и механик должен иметь возможность создать ремонт с типом долговременный и поставить статус например запланирован или ожидает деталей. так полчится что мы будем считать разницу между запланирован и в ремонте что глупо так как текущий ремонт ведь не завершен. считать долгосрочные ремонты, для долгосрочнгого ремонта не нужен статус в ремонте, ведь по факту он может ездить и дальше, это просто какое то отдаленное событие и если один и тот же велосипед попав один раз в ремонт не может попасть в него.

мы можем при необходимости перестроить структуру бд если это будет необходимо, можем передалть фэкенд с фронтендом также. но вначале я хочу составить план работы и определиться какую логику мы будем использовать, какю струткуру чтобы все работало как единый механизм. также стоит учесть что это только часть проэкта. длаьше мы будем реализовыввать работу с постоянными клиентами, прокат, продажу запчастей, ремонт чужих велосипедов  учет трудодней сотрудников, зарплаты со ставкой и процентами от кассы. учет хозрасходов и т.д. но все по очереди.

*/